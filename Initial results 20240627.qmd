---
title: "Coverage of holistic needs assessments and personalised care and support plans - England diagnoses in 2021"
format: 
  revealjs:
    smaller: true
    scrollable: true
    footer: "For internal use only"
    logo: "Logo.png"
    width: 1000
    css: styles.css
editor: visual
execute:
  echo: false
  warning: false
embed-resources: true
---

```{r prep}
library(kableExtra)
library(scales)
library(gridExtra)
library(tidyverse)

load("N:/INFO/_LIVE/NCIN/Macmillan_Partnership/HNAs/COSD level 3 analysis/Data/All_data.RData")
```

## 1. Background

Personalised care and support planning is a process to ensure patients' physical, practical, emotional and social needs are identified and supported. Guidance on using holistic needs assessment (HNA) and care planning to deliver personalised care was first published in 2007 and since then assessment and care planning (referred to as HNA/PCSP in this proposal) have been rolled out in the NHS for patients diagnosed with cancer (1-3). The NHS Long Term Plan states that "where appropriate every person diagnosed with cancer will have access to personalised care, including needs assessment, a care plan and health and wellbeing information and support" (4).

HNAs use a structured approach to gather information about patients' physical, social, emotional and financial needs, as well as their psychological and spiritual wellbeing (1-3). HNAs are usually delivered using tools such as the Macmillan eHNA system (2, 3) and are used to identify patients' concerns and develop a Personalised Care and Support Plan (PCSP) (2, 3). This can happen at any time in the cancer care pathway, and at multiple times, but is generally expected to happen pre-treatment and post-treatment, but also whenever a patient's needs change, or they request a review of their PCSP.

Personalised care is a key priority for Macmillan, both in terms of directing investment in the cancer workforce and supporting professionals to have better conversations about patients' needs (5, 6).

Since the publication of the Five Year Forward View in 2014, NHS providers have been working on provision of HNA/PCSP and other associated interventions such as EOTS (collectively formerly known as the Recovery Package) to all appropriate patients. With the formation of Cancer Alliances, this became part of their responsibilities, and the policy was formalised in the Long Term Plan 2019. NHS England outline in more detail what is needed to meet these priorities in *The Comprehensive Model for Personalised Care*, (a document that covers all patients/disease groups) including working across the health system to:

*"...develop and test the most appropriate personalised care activity metrics...\[and\] breakdown personalised care data by protected characteristics and deprivation, and track change over time to identify opportunities to promote equality and help to reduce health inequalities." (1)*

The Annual Planning Pack from the NHS Cancer Programme instructs Cancer Alliances to deliver and monitor personalised care and to tackle health inequalities. 

Since 2020 and the launch of COSD v9.0, more information on HNAs and PCSPs delivered at all NHS Trusts has been collected. NHS organisations are required to report data on the offer of HNAs for patients diagnosed with cancer, using four data items: assessment offered, assessment completed date, assessment point of pathway, and staff role carrying out the assessment. The equivalent has also been required for PCSP. Most NHS Trusts are now submitting HNA and PCSP data, meaning we can begin to explore the delivery of HNAs and PCSPs.

There is currently some research exploring the efficacy of HNAs/PCSPs, methods for using them to effectively capture patient concerns, and the mechanisms by which HNA/PCSP might influence self-advocacy (7-10). However, there is minimal evidence about the reality of delivery of HNA/ PCSP, and personalised care more generally. Understanding and monitoring the proportion of patients offered HNA/PCSP will help to evaluate the delivery of personalised care for people living with cancer and inform the provision of better personalised care across the NHS. Macmillan are also interested in understanding the coverage of HNAs to inform their delivery of the Macmillan eHNA platform and wider activity in personalised care.

References:

1)    NHS England. Personalised care and improving quality of life outcomes. Available at: <https://www.england.nhs.uk/cancer/living/>

2)    Macmillan Cancer Support. Holistic Needs Assessment (HNA). 2020. Available at: <https://www.macmillan.org.uk/cancer-information-and-support/treatment/coping-with-treatment/holistic-needs-assessment-hna>

3)    Macmillan Cancer Support. Professionals: Holistic Needs Assessments. Available at: <https://www.macmillan.org.uk/healthcare-professionals/innovation-in-cancer-care/holistic-needs-assessment>

4)    NHS England. NHS Long Term Plan. 2019. Available at: <https://www.longtermplan.nhs.uk/wp-content/uploads/2019/08/nhs-long-term-plan-version-1.2.pdf>

5)    Macmillan Cancer Support. Our Strategy 2019-2021. Available at: <https://learnzone.org.uk/downloads/strategy/Our%20Strategy%202019%20-%202021.pdf>

6)    Macmillan Cancer Support. Our plan 2023. Available at: <https://www.macmillan.org.uk/dfsmedia/1a6f23537f7f4519bb0cf14c45b2a629/11028-10061/our-plan-2023>

7)    Johnston L, Young J, Campbell K. The implementation and impact of Holistic Needs Assessments for people affected by cancer: a systematic review and thematic synthesis of literature. Eur J Cancer Care 2019; 28 (3): e13087.

8)    Sandsund C et al. Holistic needs assessment and care plans for women with gynaecological cancer: do they improve cancer-specific health-related quality of life? A randomised controlled trial using mixed methods. BMJ Supp Pall Care 2020: 10 (2): e16.

9)    Briggs L et al. Concerns, coping and the electronic Holistic Needs Assessment: experiences of UK breast cancer survivors. J Res Nursing 2019; 25 (2): 97-110. doi:10.1177/1744987119829801

10)    Snowden A et al. Holistic needs assessment in outpatient cancer care: a randomised controlled trial. BMJ Open 2023; 13: e066829.

## 2. Methods

```{r overall_figures}
percent_unique_all <- (unique_hnas_pcsps/all_records)
percent_dups_all <- 1-percent_unique_all
percent_pts_with_hna <- (pts_with_hna/hnas_denom_size)
percent_pts_with_pcsp <- (pts_with_pcsp/pcsps_denom_size)
percent_only_hna <- (only_hna/ids_either)
percent_only_pcsp <- (only_pcsp/ids_either)
percent_both <- (both/ids_either)
percent_notreqpcsps <- (pcsps_notreq/unique_off_pcsps)
```

Data sources:

Data on HNAs and PCSPs are submitted to the NHS England [Cancer Outcomes and Services Dataset (COSD)](https://digital.nhs.uk/ndrs/data/data-sets/cosd). Those records with an associated date are available in the [Rapid Cancer Registration Dataset (RCRD)](https://digital.nhs.uk/ndrs/data/data-sets/rcrd). RCRD can be linked on NHS number to patient diagnosis records.

\
Patient cohort:

Data on patients diagnosed in 2021 with a malignant cancer (C00-C97 excluding C44) were extracted from the registry. For patients with multiple tumours diagnosed in 2021, their first diagnosed tumour is used. All patients are included, regardless of whether they have any subsequent or previous diagnoses. Patients diagnosed with a stage 0 tumour were excluded from the analysis. Also excluded were death certificate only diagnoses, and patients who were diagnosed and died on the same day. There was a small number of patients with a death date recorded before their diagnosis date, who were also excluded. Lastly, a small number of patients (61) were not present in RCRD diagnosis records, as RCRD is not enhanced with the extra steps taken to create 'gold standard' registrations (see link above). These patients were also excluded.

\
Linkage:

HNA and PCSP records in RCRD were linked to the patient cohort on NHS number. Tumour records are linked to patients on patient ID and the first diagnosed tumour in 2021 used for this analysis. Other variables including tumour site grouping and deprivation decile were linked on tumour ID.

RCRD data can only be linked to the patient cohort described above at patient level, not tumour level. Therefore HNA and PCSP records are associated with a patient not a tumour, and some linked HNAs and PCSPs may be for a previous or subsequent diagnosis. For a small number of patients, this might mean a HNA/PCSP is inaccurately assigned to a trust of diagnosis, tumour site, stage at diagnosis, and deprivation decile.

\
Non-submitting Trusts:

Some trusts are not submitting HNA and PCSP data to COSD, though it is difficult to ascertain for certain which trusts are not submitting. Patients diagnosed at trusts considered to be submitting very low or no HNA/PCSP data were excluded from the analysis, to try to ensure the denominator was as accurate as possible in terms of representing trusts which are submitting HNA and PCSP data to COSD. Patients diagnosed at trusts meeting the following criteria were excluded:

-   Trusts with fewer than 10 HNA/PCSP records and fewer than 100 patients diagnosed in 2021

-   Trusts with fewer than 20 HNA/PCSP records and at least 100 patients diagnosed in 2021

This left a denominator of `r scales::comma(hnas_denom_size)` patients for HNA coverage analysis and `r scales::comma(pcsps_denom_size)` for PCSP coverage analysis, compared to 329,665 patients diagnosed in 2021 recorded in national statistics.

\
Data cleaning:

Of the `r scales::comma(all_records)` records of a HNA or PCSP, `r scales::percent(percent_unique_all, accuracy = 0.1)` (`r scales::comma(unique_hnas_pcsps)`) were unique records, meaning `r scales::percent(percent_dups_all, accuracy = 0.1)` were duplicates. This is as expected and is a result of the way COSD data is submitted by Trusts. Each time something changes in a patient's record, the entire COSD record is resubmitted, meaning a record of any previous events, such as HNAs and PCSPs, will be resubmitted, creating a second record of that event.

Records were deemed to be duplicates where records matched on the date of the HNA/PCSP, the Trust submitting the HNA/PCSP, and the COSD data items (status code, staff role code, and point of pathway code, see section 4). The data were cleaned on this basis, leaving a dataset of all unique HNA/PCSP records in the 2 years post-diagnosis for each patient. The analysis primarily explores the first recorded HNA and PCSP post-diagnosis for each patient.

\
Acknowledgements:

This work uses data that has been provided by patients and collected by the NHS as part of their care and support. The data is collated, maintained and quality assured by the National Cancer Registration and Analysis Service, which is part of NHS England.

## 3. Status of HNA and PCSP records

After excluding the non-submitting Trusts from the data, there were `r scales::comma(unique_hnas)` unique HNAs recorded for patients diagnosed in 2021 and `r scales::comma(unique_pcsps)` unique PCSPs.

`r scales::comma(hnas_notoff)` unique HNAs and `r scales::comma(pcsps_notoff)` unique PCSPs were recorded as 'not offered', and several records had invalid offered codes recorded. Meaning there were `r scales::comma(unique_off_hnas)` unique HNAs and `r scales::comma(unique_off_pcsps)` unique PCSPs which were recorded as offered to patients diagnosed in 2021 within 2 years of their diagnosis. This includes `r scales::comma(pcsps_notreq)` recorded as 'not required (no concerns from HNA)'.

Figure 3a shows the proportion of unique HNA and PCSP records with each COSD status code and the description of that code taken from the [COSD user guide](https://digital.nhs.uk/ndrs/data/data-sets/cosd/cosd-user-guide/core---clinical-nurse-specialist). The most common status code for both HNAs and PCSPs is '03 - offered and accepted'.

###### Figure 3a: Proportion of HNA and PCSP records with each status code, all unique records for patients diagnosed in 2021, excluding those recorded as 'not offered'

```{r offered_code_table, out.width='100%', fig.align='center'}

offered_code_data <- offered_code_data |>
  select(event_type, offered_code, offered_code_desc, percent) |>
  pivot_wider(names_from = "event_type", values_from = "percent") |>
  mutate(HNA = ifelse(is.na(HNA), "-", HNA)) 

kable(offered_code_data, align = "llcc", 
      col.names = c("Status code",
                    "Status", 
                    "Proportion of HNAs", 
                    "Proportion of PCSPs")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center")
  
```

## 4. Completeness and quality

Dates:

HNA and PCSP data is only available in RCRD if the record has a valid date. It was not possible to determine the extent to which missing or invalid date recording contributes to the overall missingness of the data.

\
\
NHS numbers:

This analysis uses NHS number to link patients to HNA and PCSP records. There are a very small number of HNA/PCSP records in RCRD with no NHS number (less than 0.01%), and there are very few patients in the cancer registry with no NHS number (less than 0.02% of diagnoses in 2021).

\
\
COSD data items and death dates:

COSD HNA and PCSP data includes variables for the 'point in pathway' when the HNA/PCSP was delivered, and the staff role of the person delivering the HNA/PCSP. Figure 4a shows the extent of missing data in these fields amongst all unique records of a HNA or PCSP linked to a patient diagnosed in 2021. PCSP records are more likely to have missing information than HNA records.

###### Figure 4a: Number and proportion of HNA and PCSP records with each quality measure characteristic, all unique records for patients diagnosed in 2021

```{r completeness_1, out.width='100%', fig.align='center'}

kable(filter(cosd_completeness, 
             cosd_completeness$measure != "Event date after death date"), 
      align = "lccc", 
      col.names = c("Quality measure",                                                                 "Type of event",                                                                   "Number of records",                                                              "Proportion of records"), 
      format.args = list(big.mark = ",")) |>   
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center")

```

\
\
Death dates:

A small number of records are also recorded as having occurred on dates after the patient's recorded date of death (Figure 4b).

###### Figure 4b: Number and proportion of HNA and PCSP records with each quality measure characteristic, all unique records for patients diagnosed in 2021

```{r completeness_2, out.width='100%', fig.align='center'}

kable(filter(cosd_completeness, 
             cosd_completeness$measure == "Event date after death date"), 
      align = "lccc", 
      col.names = c("Quality measure",                                                                 "Type of event",                                                                   "Number of records",                                                              "Proportion of records"), 
      format.args = list(big.mark = ",")) |>   
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center")
```

## 5. Comparison to Macmillan eHNA data

Comparing COSD HNA data to Macmillan's eHNA system data is a key aim of this project to enable better understanding of the relationship between the two datasets. The datasets currently serve complementary different purposes for analysis of personalised care delivery. Some but not all NHS Trusts use the Macmillan eHNA system to complete HNAs, and in these Trusts only some MDTs may use it, therefore Macmillan eHNA does not cover the full population, whereas COSD is mandatory for everyone diagnosed with cancer. Also, some of the discrepancies between the datasets are a consequence of cancer care teams and professionals being unwilling to double enter data in COSD and eHNA.

While Macmillan eHNA is primarily a tool to support clinical care, its dataset holds rich detail about the concerns raised and actions taken as part of a HNA and PCSP. COSD collects a record of the event date, offered status, the role fo the staff member delivering the intervention, and the point in the cancer pathway when the event occurred. Unlike Macmillan eHNA, it does not include data items covering the content of the HNA or PCSP events, but allows for a full assessment of the national and Alliance-level availability of personalised care interventions.

Details of reasons why Trusts' data may not be present in COSD are outlined in section 6.

Assessments marked as "locked" or "submitted" recorded by each NHS Trust were extracted from Macmillan eHNA data. Only assessments where the organisation type was listed as "Healthcare - secondary" were included. These data were compared to the number of unique HNAs recorded as "offered and accepted" in RCRD by Trust, occurring in 2021. This COSD HNA dataset contains HNAs occurring in 2021, rather than associated with patients diagnosed in 2021, as used in the other parts of this analysis.

`r length(not_in_ehna)` Trusts with data in RCRD did not appear in the Macmillan eHNA data. `r length(not_in_cosd)` Trusts in the Macmillan eHNA data did not appear in RCRD. Of those Trusts which do appear in both datasets, `r more_in_cosd` have more HNAs recorded in COSD than Macmillan eHNA and `r more_in_ehna` have more recorded in Macmillan eHNA than COSD.

###### Figure 5a: Number of unique HNA records in COSD compared to Macmillan eHNA by NHS Trust in 2021

![](N:/INFO/_LIVE/NCIN/Macmillan_Partnership/HNAs/COSD%20level%203%20analysis/HNA%20PCSP%20coverage%20analysis/ehna_comparison_plot.jpeg)\
\

## 6. Overall coverage

`r scales::percent(percent_pts_with_hna, accuracy = 0.1)` of patients had at least one record of being offered a HNA within 2 years of diagnosis (`r scales::comma(pts_with_hna)` patients)

`r scales::percent(percent_pts_with_pcsp, accuracy = 0.1)` of patients had at least one record of being offered a PCSP (or a PCSP being deemed 'not required') within 2 years of diagnosis (`r scales::comma(pts_with_pcsp)` patients)

Of the patients who had at least one record of either a HNA or PCSP (`r scales::comma(ids_either)`): - `r scales::percent(percent_only_hna, accuracy = 0.1)` had only a HNA recorded (`r scales::comma(only_hna)`) - `r scales::percent(percent_only_pcsp, accuracy = 0.1)` had only a PCSP recorded (`r scales::comma(only_pcsp)`) - `r scales::percent(percent_both, accuracy = 0.1)` had both a HNA and PCSP recorded (`r scales::comma(both)`). Figure 6a shows the statuses associated with first HNAs and PCSPs, amongst those patients who have a record of both.

###### Figure 6a: Proportion of patients offered both a HNA and PCSP within 2 years of diagnosis, for those diagnosed in 2021, by the status of their first record

![](N:/INFO/_LIVE/NCIN/Macmillan_Partnership/HNAs/COSD%20level%203%20analysis/HNA%20PCSP%20coverage%20analysis/offered_code_matrix_plot.jpeg)\
\

A PCSP should only occur following a HNA, so if it is assumed that all patients with only a PCSP recorded did have a HNA but this is missing from the dataset, the overall proportion of patients who had at least one HNA within 2 years of diagnosis would be 28.3%.

There are various reasons why this analysis appears to show lower than expected coverage of HNAs and PCSPs from the data available:

-   HNA and PCSP data capture was affected by the pandemic at least until 2022 because other activities by CNSs and IT and informatics teams were prioritised over personalised care data. Therefore, only a proportion of HNAs and PCSPs that happened were being digitally recorded and then only a proportion of those recorded could be submitted successfully to COSD

-   HNAs and care plans recorded in eHNA were not being submitted to COSD until a trust chose to implement the interfaces for trust using SCR or Infoflex. However, the trust may be submitting non-eHNA data to COSD so may be included in this analysis but only with a proportion of their HNA activity. NB The SCR interface has a known bug which will not be resolved until a trust adopts v24.1 which is being rolled out in latter half of 2024

-   HNAs and PCSPs may be recorded only on paper in some teams

-   HNAs and PCSPs were not being offered to some patients. The reasons for this may include inadequate staff capacity, clinic suspensions during the pandemic, and patient reluctance to attend clinics during the pandemic.

-   Some NHS Trusts were not submitting any or all HNA or PCSP data to COSD

-   Some NHS Trusts were submitting records of HNAs and PCSPs without a valid date, meaning it is not recorded in RCRD

-   This analysis includes patients of all ages, but very few HNAs and PCSPs are recorded in COSD by children's cancer teams

It is difficult to determine the extent to which each of these contribute to the statistics shown here.

## 7. Delivery across the pathway

Point in pathway code:

COSD collects the 'point in pathway' when a HNA/PCSP is delivered. This is defined by the person submitting the record using a numerical code. Figure 7a shows the proportion of unique HNA and PCSP records with each COSD point of pathway code and the description of that code taken from the [COSD user guide](https://digital.nhs.uk/ndrs/data/data-sets/cosd/cosd-user-guide/core---clinical-nurse-specialist).

The most common point of pathway recorded for both HNas and PCSPs is '01 - Initial cancer diagnosis', followed by '03 - During treatment' for HNAs and '04 - End of treatment' for PCSPs (Figure 7a).

###### Figure 7a: Proportion of HNA and PCSP records with each point of pathway code, all unique records for patients diagnosed in 2021, excluding those recorded as 'not offered'

```{r point_in_pathway, out.width='100%', fig.align='center'}

pathway_data <- pathway_data |>   
  select(-c(count, total_count, percent_graph)) |>   
  pivot_wider(names_from = "event_type", values_from = "percent")   

kable(pathway_data, align = "llcc", 
      col.names = c("Point in pathway code",                                                           "Point in pathway",                                                                "Proportion of HNAs",                                                              "Proportion of PCSPs")) |>   
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center")   

pathway_graph   
```

\
\
\
Comparison to diagnosis date:

The median time between diagnosis date and first recorded HNA is `r median_hna_diag_time` days. The median time between diagnosis date and first recorded PCSP is `r median_pcsp_diag_time` days.

###### Figure 7b: Cumulative number of patients by time between diagnosis date and first recorded HNA of patients diagnosed in 2021

```{r hna_diag_date, out.width='100%', fig.align='center'}

hna_hist
```

###### Figure 7c: Cumulative number of patients by time between diagnosis date and first recorded PCSP of patients diagnosed in 2021

```{r pcsp_diag_date, out.width='100%', fig.align='center'}

pcsp_hist
```

By 10 months post-diagnosis, 90% of those patients who are offered a HNA in the 2 years post-diagnosis have received an offer of a HNA. By 5 months post-diagnosis, 90% of those patients who are offered a PCSP in the 2 years post-diagnosis have received an offer of a PCSP.\
\
\
Multiple HNAs and PCSPs:

The majority of patients have no records of a HNA or PCSP in the 2 years post-diagnosis. 9.2% of patients have more than 1 HNA recorded in this time period, and 6.2% have more than 1 PCSP recorded.

###### Figure 7d: Proportion of patients diagnosed in 2021 receiving each number of HNAs and PCSPs in the two years post-diagnosis

```{r number_records_Figure, out.width='100%', fig.align='center'}

count_summary_Figure <- left_join(hna_count_summary, pcsp_count_summary, by = c("hna_count" = "pcsp_count"))  

count_summary_Figure <- count_summary_Figure |>   
  rename("Number of unique records" = "hna_count") |>   
  rename("HNAs" = "percent_patients_hna") |>   
  rename("PCSPs" = "percent_patients_pcsp") |>   
  select(-c(number_patients_hna, number_patients_pcsp))   

kable(count_summary_Figure, align = "lcc") |>   
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center") |>
  add_header_above(c(" " = 1, "Proportion of patients" = 2))
```

\
\
The median time between HNAs, where patients have more than 1 recorded, is `r round(median_multi_hnas, digits = 1)` days. `r scales::percent(multi_hnas_within_week, accuracy = 0.1)` of multiple HNAs for the same patient occur within a week of each other.

The median time between multiple PCSPs is `r median_multi_pcsps` days. `r scales::percent(multi_pcsps_within_week, accuracy = 0.1)` of multiple PCSPs for the same patient occur within a week of each other.\
\
\
Survival:

Patients who survive longer are more likely to have a record of a HNA and PCSP.

###### Figure 7e: Proportion of patients diagnosed in 2021 offered a HNA in the two years post-diagnosis, by survival status

```{r hna_survival, out.width='100%', fig.align='center'}

survival_hna |> 
  arrange(time_period, surv_status) |>
  ungroup() |>
  select(surv_status_table, has_hna, prop_with_hna, lower, upper) |>
  mutate(prop_with_hna = paste0(prop_with_hna, "%"), 
         lower = paste0(lower, "%"),
         upper =  paste0(upper, "%")) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Survival status", 
                      "Number of patients", 
                      "Proportion of patients", 
                      "Lower 95% confidence limit", 
                      "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center") 

surv_hna_graph
```

###### Figure 7f: Proportion of patients diagnosed in 2021 offered a PCSP in the two years post-diagnosis, by survival status

```{r pcsp_survival, out.width='100%', fig.align='center'}

survival_pcsp |> 
  arrange(time_period, surv_status) |>
  ungroup() |>
  select(surv_status_table, has_pcsp, prop_with_pcsp, lower, upper) |>
  mutate(prop_with_pcsp = paste0(prop_with_pcsp, "%"), 
         lower = paste0(lower, "%"),
         upper =  paste0(upper, "%")) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Survival status", 
                      "Number of patients", 
                      "Proportion of patients", 
                      "Lower 95% confidence limit", 
                      "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center") 

surv_pcsp_graph
```

\
*Each "Died" bar in Figure 7f represents patients who survived through the previous time period then died in the measured time period, e.g. the 6 weeks "Died" bar represents patients who died between 4 and 6 weeks post-diagnosis.*

## 8. Staff roles

COSD collects the 'staff role' of the person delivering a HNA/PCSP. This is defined by the person submitting the record using a numerical code. Figure 8a shows the proportion of unique HNA and PCSP records with each COSD staff role code and the description of that code taken from the [COSD user guide](https://digital.nhs.uk/ndrs/data/data-sets/cosd/cosd-user-guide/core---clinical-nurse-specialist).

The most common staff role recorded for both HNAs and PCSPs is '01 - Cancer Nurse Specialist', followed by '04 - Support worker' (Figure 8a).

###### Figure 8a: Proportion of HNA and PCSP records with each staff role code, all unique records for patients diagnosed in 2021, excluding those recorded as 'not offered'

```{r staff_roles, out.width='100%', fig.align='center'}

staff_role_data <- staff_role_data |>
  select(-c(count, total_count, percent_graph)) |>
  pivot_wider(names_from = "event_type", values_from = "percent") |>
  mutate(staff_role_desc = case_when(staff_role_desc == "CNS"~ "Cancer Nurse Specialist (CNS)", 
                                     staff_role_desc == "AHP" ~ "Allied Heath Professional (AHP)", 
                                     staff_role_desc == "Psychologist/MH professional"	~ "Psychologist/Mental health professional", TRUE ~ staff_role_desc ))

kable(staff_role_data, align = "llcc", col.names = c("Staff role code",
                                                    "Staff role",
                                                    "Proportion of HNAs", 
                                                    "Proportion of PCSPs")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

staff_role_graph
  
```

## 9a. Variation in coverage - gender

###### Figure 9ai: Proportion of patients diagnosed in 2021 receiving a HNA in the two years post-diagnosis, by gender

```{r gender_hna, out.width='100%', fig.align='left'}

gender_hna |> select(-hna_status, -proptest, -lower, -upper, -percent) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Gender", "Number of patients", "Proportion of patients", 
                      "Lower 95% confidence limit", "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

gender_hna_graph

```

###### Figure 9aii: Proportion of patients diagnosed in 2021 receiving a PCSP in the two years post-diagnosis, by gender

```{r gender_pcsp, out.width='100%', fig.align='left'}

gender_pcsp |> select(-pcsp_status, -proptest, -lower, -upper, -percent) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Gender", "Number of patients", "Proportion of patients", 
                      "Lower 95% confidence limit", "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

gender_pcsp_graph

```

<br> <br>

###### Figure 9aiii: Median time from diagnosis to first HNA for patients diagnosed in 2021, by gender

```{r median_hna_gender, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(gender) |>
  summarise(median = median(hna_time_diag_event, na.rm = TRUE)) |>
  filter(!is.na(gender)) |>
  mutate(gender = ifelse(gender == 1, "Male", "Female")) |>
  kable(align = "lc", 
        col.names = c("Gender", "Median number of days")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9aiv: Median time from diagnosis to first PCSP for patients diagnosed in 2021, by gender

```{r median_pcsp_gender, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(gender) |>
  summarise(median = median(pcsp_time_diag_event, na.rm = TRUE)) |>
  filter(!is.na(gender)) |>
  mutate(gender = ifelse(gender == 1, "Male", "Female")) |>
  kable(align = "lc", 
        col.names = c("Gender", "Median number of days")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9av: Proportion of patients diagnosed in 2021 whose first HNA is 'offered and accepted' and who have no PCSP records within 2 years of diagnosis, by gender

```{r hna_only_gender, out.width='100%', fig.align='center'}

gender_full_status |>
  select(gender, percent) |>
  kable(align = "lc", 
        col.names = c("Gender", "Proportion of patients")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "left") 
```

## 9b. Variation in coverage - age

###### Figure 9bi: Proportion of patients diagnosed in 2021 receiving a HNA in the two years post-diagnosis, by age

```{r age_hna, out.width='100%'}

age_hna |> 
  select(-hna_status, -proptest, -lower, -upper, -percent) |>
  arrange(age_group) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Age group", 
                      "Number of patients", 
                      "Proportion of patients", 
                      "Lower 95% confidence limit", 
                      "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center") 

age_hna_graph
```

###### Figure 9bii: Proportion of patients diagnosed in 2021 receiving a PCSP in the two years post-diagnosis, by age

```{r age_pcsp, out.width='100%'}

age_pcsp |> 
  select(-pcsp_status, -proptest, -lower, -upper, -percent) |>
    arrange(age_group) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Age group", 
                      "Number of patients", 
                      "Proportion of patients", 
                      "Lower 95% confidence limit", 
                      "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

age_pcsp_graph

```

<br> <br>

###### Figure 9biii: Median time from diagnosis to first HNA for patients diagnosed in 2021, by age

```{r median_hna_age, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(age_group) |>
  filter(!is.na(age_group)) |>
  mutate(age_group = factor(age_group, levels = c("Under 20", "20-29", "30-39", 
                                                  "40-49", "50-59", "60-69", 
                                                  "70-79", "80+"))) |>
  arrange(age_group) |>
  summarise(median = median(hna_time_diag_event, na.rm = TRUE)) |>
  kable(align = "lc",          
        col.names = c("Age group", 
                      "Median number of days")) |>   
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9biv: Median time from diagnosis to first PCSP for patients diagnosed in 2021, by age

```{r median_pcsp_age, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(age_group) |>
  filter(!is.na(age_group)) |>
  mutate(age_group = factor(age_group, levels = c("Under 20", "20-29", "30-39", 
                                                  "40-49", "50-59", "60-69", 
                                                  "70-79", "80+"))) |>
  arrange(age_group) |>
  summarise(median = median(pcsp_time_diag_event, na.rm = TRUE)) |>
  kable(align = "lc",          
        col.names = c("Age group", 
                      "Median number of days")) |>   
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9bv: Proportion of patients diagnosed in 2021 whose first HNA is 'offered and accepted' and who have no PCSP records within 2 years of diagnosis, by age

```{r hna_only_age, out.width='100%', fig.align='center'}

age_full_status |>   
  select(age_group, percent) |> 
  mutate(age_group = factor(age_group, levels = c("Under 20", "20-29", "30-39", 
                                                  "40-49", "50-59", "60-69", 
                                                  "70-79", "80+"))) |>
  arrange(age_group) |>
  kable(align = "lc",          
        col.names = c("Age group", 
                      "Proportion of patients")) |>   
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),                  full_width = F, font_size = 12, position = "left") 
```

## 9c. Variation in coverage - ethnicity

###### Figure 9ci: Proportion of patients diagnosed in 2021 receiving a HNA in the two years post-diagnosis, by ethnicity

```{r ethnicity_hna, out.width='100%', fig.align='center'}

ethnicity_hna |> select(-hna_status, -proptest, -lower, -upper, -percent) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Age group","Number of patients", "Proportion of patients", 
                      "Lower 95% confidence limit", "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center")

ethnicity_hna_graph
```

###### Figure 9cii: Proportion of patients diagnosed in 2021 receiving a PCSP in the two years post-diagnosis, by ethnicity

```{r ethnicity_pcsp, out.width='100%', fig.align='center'}

ethnicity_pcsp |> select(-pcsp_status, -proptest, -lower, -upper, -percent) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Age group", "Number of patients", "Proportion of patients", 
                      "Lower 95% confidence limit", "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

ethnicity_pcsp_graph
```

<br> <br>

###### Figure 9ciii: Median time from diagnosis to first PCSP for patients diagnosed in 2021, by ethnicity

```{r median_hna_ethnicity, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(ethnicity_group) |>
  summarise(median = round(median(hna_time_diag_event, na.rm = TRUE), 0)) |>
  filter(!is.na(ethnicity_group)) |>
  kable(align = "lc",                   
        col.names = c("Ethnicity", "Median number of days")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9civ: Median time from diagnosis to first PCSP for patients diagnosed in 2021, by ethnicity

```{r median_pcsp_ethnicity, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(ethnicity_group) |>
  summarise(median = round(median(pcsp_time_diag_event, na.rm = TRUE), 0)) |>
  filter(!is.na(ethnicity_group)) |>
  kable(align = "lc",                   
        col.names = c("Ethnicity", "Median number of days")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9cv: Proportion of patients diagnosed in 2021 whose first HNA is 'offered and accepted' and who have no PCSP records within 2 years of diagnosis, by ethnicity

```{r hna_only_ethnicity, out.width='100%', fig.align='center'}

ethnicity_full_status |>   
  select(ethnicity_group, percent) |>   
  kable(align = "lc",          
        col.names = c("Ethnicity", "Proportion of patients")) |>   
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),                  full_width = F, font_size = 12, position = "left") 
```

## 9d. Variation in coverage - deprivation

###### Figure 9di: Proportion of patients diagnosed in 2021 receiving a HNA in the two years post-diagnosis, by deprivation decile

```{r imd_hna, out.width='100%', fig.align='center'}

imd_hna |> 
  arrange(imd19_decile_lsoas) |>
  select(-c(hna_status, proptest, lower, upper, percent)) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Deprivation decile", 
                      "Number of patients", 
                      "Proportion of patients", 
                      "Lower 95% confidence limit", 
                      "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center") 

imd_hna_graph
```

###### Figure 9dii: Proportion of patients diagnosed in 2021 receiving a PCSP in the two years post-diagnosis, by deprivation decile

```{r imd_pcsp, out.width='100%', fig.align='center'}

imd_pcsp |> 
  arrange(imd19_decile_lsoas) |>
  select(-c(pcsp_status, proptest, lower, upper, percent)) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Deprivation decile", 
                      "Number of patients", 
                      "Proportion of patients", 
                      "Lower 95% confidence limit", 
                      "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center") 

imd_pcsp_graph
```

<br> <br>

###### Figure 9diii: Median time from diagnosis to first HNA for patients diagnosed in 2021, by deprivation decile

```{r median_hna_imd, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(imd19_decile_lsoas) |>
  summarise(median = median(hna_time_diag_event, na.rm = TRUE)) |>
  filter(!is.na(imd19_decile_lsoas)) |>
  mutate(imd19_decile_lsoas = factor(imd19_decile_lsoas, 
                                       levels = c("1 - most deprived", "2", "3",
                                                  "4", "5", "6", "7", "8", 
                                                  "9", "10 - least deprived"))) |>
  arrange(imd19_decile_lsoas) |>
  kable(align = "lc",                   
        col.names = c("Deprivation decile", "Median number of days")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9div: Median time from diagnosis to first PCSP for patients diagnosed in 2021, by deprivation decile

```{r median_pcsp_imd, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(imd19_decile_lsoas) |>
  summarise(median = median(pcsp_time_diag_event, na.rm = TRUE)) |>
  filter(!is.na(imd19_decile_lsoas)) |>
  mutate(imd19_decile_lsoas = factor(imd19_decile_lsoas, 
                                       levels = c("1 - most deprived", "2", "3",
                                                  "4", "5", "6", "7", "8", 
                                                  "9", "10 - least deprived"))) |>
  arrange(imd19_decile_lsoas) |>
  kable(align = "lc",                   
        col.names = c("Deprivation decile", "Median number of days")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9dv: Proportion of patients diagnosed in 2021 whose first HNA is 'offered and accepted' and who have no PCSP records within 2 years of diagnosis, by deprivation decile

```{r hna_only_imd, out.width='100%', fig.align='center'}

imd_full_status |>      
  select(imd19_decile_lsoas, percent) |>
  mutate(imd19_decile_lsoas = factor(imd19_decile_lsoas, 
                                       levels = c("1 - most deprived", "2", "3",
                                                  "4", "5", "6", "7", "8", 
                                                  "9", "10 - least deprived"))) |>
  arrange(imd19_decile_lsoas) |>
  kable(align = "lc",                   
        col.names = c("Deprivation decile", "Proportion of patients")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),                  full_width = F, font_size = 12, position = "left") 
```

## 9e. Variation in coverage - tumour type

For some tumour types, the total number of patients diagnosed in 2021 is less than 1,000. Figures for these tumour types have been suppressed.

###### Figure 9ei: Proportion of patients diagnosed in 2021 receiving a HNA in the two years post-diagnosis, by tumour type

```{r site_hna, out.width='100%', fig.align='center'}

site_hna |> 
  select(-c(proptest, lower, upper, number_patients, 
            percent, hna_status, suppress)) |>
  select(c(ndrs_main, number_patients_table, percent_table, lower_table, upper_table)) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Tumour type",
                      "Number of patients", 
                      "Proportion of patients",
                      "Lower 95% confidence limit", 
                      "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center") 

site_hna_graph
```

###### Figure 9eii: Proportion of patients diagnosed in 2021 receiving a PCSP in the two years post-diagnosis, by tumour type

```{r site_pcsp, out.width='100%', fig.align='center'}

site_pcsp |> 
  select(-c(proptest, lower, upper, number_patients, 
            percent, pcsp_status, suppress)) |>
  select(c(ndrs_main, number_patients_table, percent_table, lower_table, upper_table)) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Tumour type",
                      "Number of patients", 
                      "Proportion of patients",
                      "Lower 95% confidence limit", 
                      "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = F, font_size = 12, position = "center") 

site_pcsp_graph
```

<br> <br>

###### Figure 9eiii: Median time from diagnosis to first HNA for patients diagnosed in 2021, by tumour type

```{r median_hna_site, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(ndrs_main) |>
  summarise(median = round(median(hna_time_diag_event, na.rm = TRUE),0)) |>
  filter(!is.na(ndrs_main), 
         !ndrs_main %in% c("to be grouped", "See skin table")) |>
  kable(align = "lc",                   
        col.names = c("Tumour type", "Median number of days")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "left")
```

<br> <br>

###### Figure 9eiv: Median time from diagnosis to first PCSP for patients diagnosed in 2021, by tumour type

```{r median_pcsp_site, out.width='100%', fig.align='left'}

patient_level_data |>
  group_by(ndrs_main) |>
  summarise(median = round(median(pcsp_time_diag_event, na.rm = TRUE),0)) |>
  filter(!is.na(ndrs_main), 
         !ndrs_main %in% c("to be grouped", "See skin table")) |>
  kable(align = "lc",                   
        col.names = c("Tumour type", "Median number of days")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "left")
```

<br> <br>

###### Figure 9ev: Proportion of patients diagnosed in 2021 whose first HNA is 'offered and accepted' and who have no PCSP records within 2 years of diagnosis, by tumour type

```{r hna_only_site, out.width='100%', fig.align='center'}

site_full_status |>         
  select(ndrs_main, percent) |>         
  kable(align = "lc",                            
        col.names = c("Tumour type", "Proportion of patients")) |>         
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),                  full_width = F, font_size = 12, position = "left") 
```

## 9f. Variation in coverage - stage at diagnosis

###### Figure 9fi: Proportion of patients diagnosed in 2021 receiving a HNA in the two years post-diagnosis, by stage at diagnosis

```{r stage_hna, out.width='100%', fig.align='center'}

stage_hna |> select(-c(proptest, lower, upper, percent, hna_status)) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Stage at diagnosis","Number of patients", "Proportion of patients", 
                      "Lower 95% confidence limit", "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

stage_hna_graph
```

###### Figure 9fii: Proportion of patients diagnosed in 2021 receiving a PCSP in the two years post-diagnosis, by stage at diagnosis

```{r stage_pcsp, out.width='100%', fig.align='center'}

stage_pcsp |> select(-c(proptest, pcsp_status, lower, upper, percent)) |>
  kable(format.args = list(big.mark = ","), align = "lcccc", 
        col.names = c("Stage at diagnosis","Number of patients", "Proportion of patients", 
                      "Lower 95% confidence limit", "Upper 95% confidence limit")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

stage_pcsp_graph
```

<br> <br>

###### Figure 9fiii: Median time from diagnosis to first HNA for patients diagnosed in 2021, by stage at diagnosis

```{r median_hna_stage, out.width='100%', fig.align='left'}

patient_level_data |>
  filter(!is.na(STAGE), STAGE != "Error") |>
  group_by(STAGE) |>
  summarise(median = median(hna_time_diag_event, na.rm = TRUE)) |>
  filter(!is.na(STAGE)) |>
  kable(align = "lc",                   
        col.names = c("Stage at diagnosis", "Median number of days")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9fiv: Median time from diagnosis to first PCSP for patients diagnosed in 2021, by stage at diagnosis

```{r median_pcsp_stage, out.width='100%', fig.align='left'}

patient_level_data |>
  filter(!is.na(STAGE), STAGE != "Error") |>
  group_by(STAGE) |>
  summarise(median = median(pcsp_time_diag_event, na.rm = TRUE)) |>
  filter(!is.na(STAGE)) |>
  kable(align = "lc",                   
        col.names = c("Stage at diagnosis", "Median number of days")) |>      
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "left") 
```

<br> <br>

###### Figure 9fv: Proportion of patients diagnosed in 2021 whose first HNA is 'offered and accepted' and who have no PCSP records within 2 years of diagnosis, by stage at diagnosis

```{r hna_only_stage, out.width='100%', fig.align='center'}

stage_full_status |>            
  select(STAGE, percent) |>            
  kable(align = "lc",                                    
        col.names = c("Stage at diagnosis", "Proportion of patients")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),                  full_width = F, font_size = 12, position = "left") 
```

## 9g. Variation in coverage - geography

Geographic variation is measured by the trust of diagnosis, which is assumed to be the most likely trust delivering first HNAs and PCSPs.

###### Figure 9gi: Number of trusts by HNA coverage among patients diagnosed in 2021

```{r geog_hna, out.width='100%', fig.align='center'}

trust_coverage_hna_cats |> 
  kable(format.args = list(big.mark = ","), align = "lc", 
        col.names = c("Proportion of patients offered a HNA", "Number of trusts")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

trust_hna_graph
```

###### Figure 9gii: Number of trusts by PCSP coverage among patients diagnosed in 2021

```{r geog_pcsp, out.width='100%', fig.align='center'}

trust_coverage_pcsp_cats |> 
  kable(format.args = list(big.mark = ","), align = "lc", 
        col.names = c("Proportion of patients offered a PCSP", "Number of trusts")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, font_size = 12, position = "center") 

trust_pcsp_graph
```

NHS trusts do not have clearly defined catchment areas, so the below shows the average coverage in NHS trusts within each ICB.

###### Figure 9giii: HNA coverage in patients diagnosed in 2021 by ICB

![](C:/Users/elau2/OneDrive%20-%20NHS%20Digital/Documents/HNA_PCSP_coverage/hna_map.jpeg)

###### Figure 9giv: PCSP coverage in patients diagnosed in 2021 by ICB

![](C:/Users/elau2/OneDrive%20-%20NHS%20Digital/Documents/HNA_PCSP_coverage/pcsp_map.jpeg)
